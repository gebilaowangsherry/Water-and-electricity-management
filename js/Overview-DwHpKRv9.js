const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/echarts-mBAUMFU9.js","js/vendor-Uhp0TdW6.js"])))=>i.map(i=>d[i]);
import{_ as I,a as $}from"../assets/index-D8pj-Nfg.js";import{bF as p,bG as L,bZ as O,c1 as T,bA as U,bB as g,bC as s,cb as i,c4 as r,cc as N,cU as R,cS as y,bH as x,cA as C,cz as h,c$ as S,cf as G,c3 as P}from"./vendor-Uhp0TdW6.js";import{m as W,o as B,p as j}from"./element-plus-IvV6zMkc.js";const M={class:"overview-container"},H={class:"card-header"},X={class:"card-content"},Z={class:"stat-item"},q={class:"stat-item"},J={class:"card-header"},K={class:"card-header"},Q={__name:"Overview",setup(Y){const d=p([]),u=p(null),v=p(null),c=p("water"),f=p(!1),m=p(!1),w=L(()=>c.value==="water"?"用水量统计":"用电量统计"),k=["周一","周二","周三","周四","周五","周六","周日"],A=t=>{const a=t.floors.reduce((e,o)=>(o.weeklyUsage.forEach(n=>{e.water+=n.waterUsage,e.electricity+=n.electricityUsage}),e),{water:0,electricity:0});return{...t,totalWaterUsage:a.water.toFixed(2),totalElectricityUsage:a.electricity.toFixed(2)}},F=()=>{u.value||(u.value=echarts.init(document.getElementById("pie-chart"))),v.value||(v.value=echarts.init(document.getElementById("line-chart"))),f.value=!0,_()},_=()=>{if(!f.value||d.value.length===0)return;const t=d.value.map(e=>({value:parseFloat(c.value==="water"?e.totalWaterUsage:e.totalElectricityUsage),name:e.name})),a=d.value.map(e=>{const o=[0,0,0,0,0,0,0];return e.floors.forEach(n=>{n.weeklyUsage.forEach((l,D)=>{o[D]+=c.value==="water"?l.waterUsage:l.electricityUsage})}),{name:e.name,type:"line",data:o.map(n=>parseFloat(n.toFixed(1))),smooth:!0,showSymbol:!0}});u.value.setOption({title:{text:"各教学楼占比",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:d.value.map(e=>e.name)},series:[{name:c.value==="water"?"用水量(吨)":"用电量(度)",type:"pie",radius:"50%",data:t,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),v.value.setOption({title:{text:w.value,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{const o=c.value==="water"?"吨":"度";return e.reduce((n,l)=>`${n}${l.marker} ${l.seriesName}: ${l.value}${o}<br/>`,`${e[0].axisValue}<br/>`)}},legend:{data:d.value.map(e=>e.name),bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:k},yAxis:{type:"value",name:c.value==="water"?"用水量(吨)":"用电量(度)"},series:a})},E=async()=>{if(!m.value){m.value=!0;try{const{data:t}=await S.get("/building.json");console.log("Fetched data:",t);const a=Array.isArray(t)?t:t.buildings||[];d.value=a.map(e=>A(e)),await G(),f.value?_():F()}catch(t){console.error("Error fetching data:",t),j.error("数据加载失败")}finally{m.value=!1}}},V=()=>{_()},b=()=>{u.value&&u.value.resize(),v.value&&v.value.resize()};let z;return O(()=>{window.echarts?E():$(()=>import("./echarts-mBAUMFU9.js").then(t=>t.j),__vite__mapDeps([0,1])).then(t=>{window.echarts=t,E()}),window.addEventListener("resize",b)}),T(()=>{window.removeEventListener("resize",b),u.value&&u.value.dispose(),v.value&&v.value.dispose(),clearInterval(z)}),(t,a)=>{const e=y("el-card"),o=y("el-col"),n=y("el-row");return g(),U("div",M,[a[5]||(a[5]=s("h3",null,"第一周教学楼用水用电量",-1)),i(n,{gutter:20,class:"card-row",id:"chart-container"},{default:r(()=>[(g(!0),U(N,null,R(d.value,l=>(g(),P(o,{span:6,key:l.name},{default:r(()=>[i(e,{shadow:"hover",class:"building-card"},{header:r(()=>[s("div",H,[s("span",null,h(l.name),1)])]),default:r(()=>[s("div",X,[s("div",Z,[s("span",null,"用水量："+h(l.totalWaterUsage)+"吨",1)]),s("div",q,[s("span",null,"用电量："+h(l.totalElectricityUsage)+"度",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),i(n,{gutter:20,class:"chart-row"},{default:r(()=>[i(o,{span:24,class:"chart-switch"},{default:r(()=>[i(x(W),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value=l),onChange:V},{default:r(()=>[i(x(B),{value:"water"},{default:r(()=>a[1]||(a[1]=[C("用水量")])),_:1}),i(x(B),{value:"electricity"},{default:r(()=>a[2]||(a[2]=[C("用电量")])),_:1})]),_:1},8,["modelValue"])]),_:1}),i(o,{span:12},{default:r(()=>[i(e,{shadow:"hover",class:"chart-card"},{header:r(()=>[s("div",J,[s("span",null,h(w.value)+"（饼图）",1)])]),default:r(()=>[a[3]||(a[3]=s("div",{id:"pie-chart",class:"chart-container1"},null,-1))]),_:1})]),_:1}),i(o,{span:12},{default:r(()=>[i(e,{shadow:"hover",class:"chart-card"},{header:r(()=>[s("div",K,[s("span",null,h(w.value)+"（折线图）",1)])]),default:r(()=>[a[4]||(a[4]=s("div",{id:"line-chart",class:"chart-container2"},null,-1))]),_:1})]),_:1})]),_:1})])}}},re=I(Q,[["__scopeId","data-v-09326fae"]]);export{re as default};
